{% extends '::base.html.twig' %}
{% trans_default_domain 'chat' %}

{% block javascripts %}
    <script>
        var sendPath = '{{ url('chat_add') }}';
        var refreshPath = '{{ url('chat_refresh') }}';
        var changeChannelPath = '{{ url('change_channel_chat') }}';
        var languagePath = {
          'pl' : '{{ url("homepage", {"_locale" : "pl"}) }}',
          'en' : '{{ url("homepage", {"_locale" : "en"}) }}'
        };
        var self = {
          'username' : '{{ user.username }}',
          'role' : '{{ user.getChatRoleAsText }}',
        };
        var emoticons = [
            ':)',
            ':(',
            [
                ':D',
                ';D',
                ':d',
                ';d'
            ],
            [
                ':P',
                ':p',
                ';p',
                ';P'
            ],
            ';)',
            ':o)',
        ];
        {# emoticons from Ajax Chat http://frug.github.io/AJAX-Chat/ #}
        var emoticonsImg = [
            '{{ asset('img/smile.png') }}',
            '{{ asset('img/sad.png') }}',
            '{{ asset('img/grin.png') }}',
            '{{ asset('img/razz.png') }}',
            '{{ asset('img/wink.png') }}',
            '{{ asset('img/monkey.png') }}',
        ];
        var newMessageSound = '{{ asset('sound/message.mp3') }}';
    </script>
    {#language script#}
    <script type="text/javascript" src="{{ asset('js/' ~ locale ~ '.js') }}"></script>
    {#chat script#}
    <script type="text/javascript" src="{{ asset('js/chat.js') }}"></script>
    <script type="text/javascript" src="{{ asset('js/jquery.scrollTo.js') }}"></script>
    {% if is_granted('ROLE_MODERATOR') %}
        <script>
            var deletePath = '{{ url('chat_delete') }}';
        </script>
        <script type="text/javascript" src="{{ asset('js/delete.js') }}"></script>
    {% endif %}
{% endblock %}
{% block stylesheets %}
    <link rel="stylesheet" href="{{ asset('css/style.css') }}">
{% endblock %}

{% block content %}
    <div class="row chat" id="chat-row-main">
        <div class="col-xs-12 padding-bottom-small" id="info-box">
            <select class="custom-select" id="channels">
                {% for key,value in channels %}
                    <option value="{{ key }}" {%  if (key == user_channel) %}selected{% endif %}>{{ ('channel.' ~ value)|trans }}</option>
                {% endfor %}
            </select>
            <select class="custom-select" id="locale">
                <option value="pl" {%  if (locale == 'pl') %}selected{% endif %}>PL</option>
                <option value="en" {%  if (locale == 'en') %}selected{% endif %}>EN</option>
            </select>
            {% if is_granted('ROLE_ADMIN') %}
                <a href="{{ path('chat_admin') }}" target="_blank">{{ 'panel'|trans }}</a>
            {% endif %}
            <a href="{{ path("chat_logout") }}" class="btn btn-info">{{ 'logout'|trans }}</a>
        </div>

        <div class="col-xs-7 col-md-9" id="messages">
            <div class="panel panel-success" id="panel-messages">
                <div class="panel-heading text-center">
                    {{ 'messages'|trans }}
                </div>
                <div class="panel-body" id="messages-box">
                    {%  for message in messages|sort %}
                        <div class="message" data-id="{{ message.id }}">
                            <span class="date">({{ message.date|date('H:i:s') }})</span>
                            <span class="{{ message.user_role }} text-bold">{{ message.username }}:</span>
                            <span class="message-text">
                                {{ message.text }}
                            </span>
                            {% if is_granted('ROLE_MODERATOR') %}
                            <span class="pull-right kursor" data-id="{{ message.id }}">&times;</span>
                            {% endif %}
                        </div>
                    {% endfor %}
                </div>
            </div>
        </div>
        <div class="col-xs-5 col-md-3" id="online-users">
            <div class="panel panel-success" id="panel-users">
                <div class="panel-heading text-center">
                    {{ 'online'|trans }}
                </div>
                <div class="panel-body" >
                    <div class="{{ user.getChatRoleAsText }}" id="username">{{ user.username }}</div>
                    <div id="users-box">
                        {%  for user in usersOnline %}
                            <div class="{{ user.user_role }}">{{ user.username }}</div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
        <div class="col-xs-12 margin-top-minus">
            <div class="row">
                <div class="col-xs-12">
                    <button class="btn btn-success" id="emoticons">{{ 'emoticons'|trans }}</button>
                    <div class="hidden-div" name="emoticons"></div>
                </div>
                <div class="col-xs-11">
                    <textarea class="form-control" id="message-text" cols="50" rows="1"></textarea>
                </div>
                <div class="col-xs-1">
                    <button class="btn btn-success btn-block" id="send">{{ 'send'|trans }}</button>
                </div>
            </div>
        </div>
    </div>

{% endblock %}
